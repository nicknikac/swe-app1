container_commands:
  01_make_tmp_dirs:
    command: "mkdir -p /tmp/django_sessions && chmod 777 /tmp/django_sessions && chmod 777 /tmp && touch /tmp/db.sqlite3 && chmod 666 /tmp/db.sqlite3"

  02_migrate:
    command: "source /var/app/venv/*/bin/activate && python manage.py migrate --noinput"

  03_collectstatic:
    command: "source /var/app/venv/*/bin/activate && python manage.py collectstatic --noinput"
    leader_only: true

  04_create_superuser:
    command: "source /var/app/venv/*/bin/activate && echo \"from django.contrib.auth.models import User; \
    User.objects.filter(username='admin').exists() or \
    User.objects.create_superuser('admin','admin@example.com','adminpass123!')\" \
    | python manage.py shell"
    leader_only: true

  05_seed_polls:
    command: "source /var/app/venv/*/bin/activate && echo \"from polls.models import Question, Choice; \
    import datetime; \
    if not Question.objects.exists(): \
        q = Question.objects.create(question_text='Do you like this polls app?', pub_date=datetime.datetime.now()); \
        Choice.objects.create(question=q, choice_text='Yes'); \
        Choice.objects.create(question=q, choice_text='No')\" \
    | python manage.py shell"
    leader_only: true

option_settings:
  aws:elasticbeanstalk:application:environment:
    DJANGO_SETTINGS_MODULE: "mysite.settings"
    PYTHONPATH: "/var/app/current:$PYTHONPATH"
  aws:elasticbeanstalk:container:python:
    WSGIPath: mysite.wsgi:application
  aws:elasticbeanstalk:environment:proxy:staticfiles:
    /static: static